<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-100 text-gray-800 pb-24">

  <!-- Header Saldo -->
  <div class="bg-green-600 text-white px-6 py-6 pt-10 rounded-b-3xl shadow-md">
    <div class="text-sm">Saldo Kamu</div>
    <div id="saldo" class="text-3xl font-bold">Rp 0</div>
    <div id="nomorTampil" class="text-xs mt-1">Nomor: </div>
  </div>

  <!-- Menu -->
  <div class="grid grid-cols-4 gap-4 p-4 bg-white mx-4 mt-6 rounded-xl shadow-lg">
    <div onclick="alert('Fitur belum aktif')" class="flex flex-col items-center">
      <div class="bg-green-100 p-3 rounded-full">
        <i data-lucide="scan" class="w-5 h-5 text-green-600"></i>
      </div>
      <span class="text-xs mt-1">Scan</span>
    </div>

    <div onclick="handleKirim()" class="flex flex-col items-center cursor-pointer">
      <div class="bg-green-100 p-3 rounded-full">
        <i data-lucide="send" class="w-5 h-5 text-green-600"></i>
      </div>
      <span class="text-xs mt-1">Kirim</span>
    </div>

    <div onclick="handleTopup()" class="flex flex-col items-center cursor-pointer">
      <div class="bg-green-100 p-3 rounded-full">
        <i data-lucide="download" class="w-5 h-5 text-green-600"></i>
      </div>
      <span class="text-xs mt-1">Top Up</span>
    </div>

    <div onclick="handleMinta()" class="flex flex-col items-center cursor-pointer">
      <div class="bg-green-100 p-3 rounded-full">
        <i data-lucide="arrow-down-circle" class="w-5 h-5 text-green-600"></i>
      </div>
      <span class="text-xs mt-1">Minta</span>
    </div>
  </div>

  <!-- Footer -->
  <div class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-md flex justify-around py-3 z-50">
    <a href="dashboard.html" class="flex flex-col items-center text-green-600">
      <i data-lucide="home" class="w-5 h-5"></i>
      <span class="text-xs">Beranda</span>
    </a>
    <a href="profil.html" class="flex flex-col items-center text-gray-500">
      <i data-lucide="user" class="w-5 h-5"></i>
      <span class="text-xs">Profil</span>
    </a>
  </div>

  <script>
    lucide.createIcons();

    document.addEventListener("DOMContentLoaded", () => {
      const nomor = localStorage.getItem("nomorHP");
      if (!nomor) return location.href = "login.html";

      document.getElementById("nomorTampil").textContent = "Nomor: " + nomor;

      const saldoData = JSON.parse(localStorage.getItem("dataSaldo")) || {};
      const saldo = saldoData[nomor] || 0;
      document.getElementById("saldo").textContent = "Rp " + saldo.toLocaleString();
    });

    function updateSaldo(nomor, nominal, isTambah) {
      let dataSaldo = JSON.parse(localStorage.getItem("dataSaldo")) || {};
      let saldoSekarang = dataSaldo[nomor] || 0;

      if (!isTambah && saldoSekarang < nominal) {
        alert("Saldo tidak cukup!");
        return false;
      }

      dataSaldo[nomor] = isTambah
        ? saldoSekarang + nominal
        : saldoSekarang - nominal;

      localStorage.setItem("dataSaldo", JSON.stringify(dataSaldo));
      return true;
    }

    function handleKirim() {
      const target = prompt("Masukkan nomor tujuan:");
      if (!target) return;

      const nominal = parseInt(prompt("Masukkan jumlah saldo yang ingin dikirim:"), 10);
      if (!nominal || nominal <= 0) return;

      const pengirim = localStorage.getItem("nomorHP");

      if (pengirim === target) {
        alert("Tidak bisa kirim ke nomor sendiri.");
        return;
      }

      const suksesKurang = updateSaldo(pengirim, nominal, false);
      if (!suksesKurang) return;

      updateSaldo(target, nominal, true);

      alert(`✅ Saldo berhasil dikirim ke ${target}\nNominal: Rp ${nominal.toLocaleString()}`);

      // Refresh tampilan saldo
      const dataSaldo = JSON.parse(localStorage.getItem("dataSaldo")) || {};
      document.getElementById("saldo").textContent = "Rp " + (dataSaldo[pengirim] || 0).toLocaleString();
    }

    function handleMinta() {
      const dari = prompt("Minta saldo dari nomor:");
      if (!dari) return;

      const nominal = parseInt(prompt("Masukkan jumlah saldo yang diminta:"), 10);
      if (!nominal || nominal <= 0) return;

      const penerima = localStorage.getItem("nomorHP");

      if (penerima === dari) {
        alert("Tidak bisa minta dari nomor sendiri.");
        return;
      }

      const suksesKurang = updateSaldo(dari, nominal, false);
      if (!suksesKurang) return;

      updateSaldo(penerima, nominal, true);

      alert(`✅ Berhasil minta saldo dari ${dari}\nNominal: Rp ${nominal.toLocaleString()}`);

      // Refresh tampilan saldo
      const dataSaldo = JSON.parse(localStorage.getItem("dataSaldo")) || {};
      document.getElementById("saldo").textContent = "Rp " + (dataSaldo[penerima] || 0).toLocaleString();
    }

    function handleTopup() {
      const nominal = parseInt(prompt("Masukkan nominal top up:"), 10);
      if (!nominal || nominal <= 0) return;

      const nomor = localStorage.getItem("nomorHP");

      let dataSaldo = JSON.parse(localStorage.getItem("dataSaldo")) || {};
      dataSaldo[nomor] = (dataSaldo[nomor] || 0) + nominal;
      localStorage.setItem("dataSaldo", JSON.stringify(dataSaldo));

      document.getElementById("saldo").textContent = "Rp " + dataSaldo[nomor].toLocaleString();
      alert("Top up berhasil!");
    }
  </script>
</body>
</html>